<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>App de Layout · Tiendas ARA</title>

  <style>
    :root{
      --primary:#ea1d2c;
      --accent:#ff6a00;
      --bg:#f7f7f9;
      --text:#1f2937;
      --muted:#6b7280;
      --card:#ffffff;
      --border:#e5e7eb;
      --radius:14px;
      --shadow:0 6px 20px rgba(0,0,0,.06);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      line-height:1.45;
    }

    /* Header sticky y seguro en móviles con notch */
    header{
      position: sticky;
      top: 0;
      z-index: 1000;
      padding-top: env(safe-area-inset-top);
      background:linear-gradient(90deg,var(--primary),var(--accent));
      color:#fff;
      box-shadow:0 1px 0 rgba(0,0,0,.05);
    }
    header .wrap{
      max-width:1100px; margin:0 auto;
      display:flex; align-items:center; gap:12px;
      padding:14px 16px;
    }
    header img.logo-ara{
      height:clamp(28px, 4.5vw, 56px);
      width:auto; object-fit:contain;
      image-rendering:-webkit-optimize-contrast;
      image-rendering:crisp-edges;
    }
    header h1{
      margin:0; font-weight:700; font-size:clamp(16px, 2.2vw, 22px);
      letter-spacing:.2px;
      flex:1;
    }
    /* Botón admin discreto */
    .btn-ghost{
      background:transparent; color:#fff; border:1px solid rgba(255,255,255,.6);
      border-radius:10px; padding:6px 10px; cursor:pointer; font-weight:600;
      opacity:.85;
    }
    .btn-ghost:hover{ opacity:1 }

    /* Layout principal */
    main{max-width:1100px; margin:20px auto; padding:0 14px 48px;}

    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px 18px;
      margin-bottom:18px;
    }
    .title{font-size:clamp(18px,1.9vw,20px); font-weight:700; margin:0 0 12px;}
    .status{font-size:14px; color:var(--muted); margin:6px 0 10px}
    .muted{color:var(--muted)}
    .hidden{ display:none !important; }

    .row{display:grid; grid-template-columns:1fr; gap:12px}
    @media (min-width:900px){
      .row{grid-template-columns:1fr 1fr}
    }

    input,select{
      width:100%; height:44px;
      border:1px solid var(--border);
      border-radius:12px;
      padding:0 12px;
      font-size:16px; background:#fff;
    }

    .btn{
      display:inline-block;
      background:linear-gradient(90deg,var(--accent),var(--primary));
      color:#fff; border:none; border-radius:12px;
      padding:12px 18px; font-weight:600; cursor:pointer;
      transition:filter .15s ease;
    }
    .btn:hover{ filter:brightness(1.04) }
    .btn:disabled{ opacity:.6; cursor:not-allowed }

    /* Accesibilidad focus */
    button:focus-visible, input:focus-visible, select:focus-visible, a:focus-visible{
      outline:2px solid var(--accent);
      outline-offset:2px;
    }

    /* Visor PDF responsive */
    #pdfContainer{ display:none; margin-top:12px; }
    #pdfFrame{
      width:100%;
      min-height:60vh;
      border:1px solid var(--border);
      border-radius:12px;
      background:#fff;
    }
    @media (min-width:900px){
      #pdfFrame{ min-height:78vh }
    }

    @media (prefers-reduced-motion: reduce){
      .btn{ transition:none }
    }
  </style>

  <!-- 1) XLSX debe ir ANTES de app.js -->
  <script src="./lib/xlsx.full.min.js"></script>

  <!-- 2) ENV para que env-gh.js construya URLs -->
  <script>
    window.ENV = {
      GH_OWNER:  'Danray11',
      GH_REPO:   'ara-data',
      GH_BRANCH: 'main',
      GH_PATH_PDFS:  'pdfs/',
      GH_PATH_EXCEL: 'data/Layout.xlsx'
    };
  </script>

  <!-- Construye window.URL_EXCEL (RAW/MEDIA) y window.PDF_BASE (MEDIA) -->
  <script src="env-gh.js"></script>

  <!-- Lógica principal -->
  <script defer src="app.js"></script>
</head>
<body>

  <header>
    <div class="wrap">
      <img class="logo-ara" src="Logo_ARA.png" alt="Logo ARA">
      <h1>App de layout · Tiendas ARA</h1>
      <!-- Botón admin para mostrar/ocultar la tarjeta de estado -->
      <button id="btnAdmin" class="btn-ghost" title="Modo administrador">Admin</button>
    </div>
  </header>

  <main>
    <!-- ESTADO (oculto por defecto; visible solo en modo admin) -->
    <section class="card hidden" id="cardEstado">
      <h2 class="title">Estado de datos en la nube</h2>
      <div id="estado" class="status">Cargando…</div>

      <div style="margin-top:6px">
        <button id="btnReintentar" class="btn" type="button" onclick="location.reload()">Reintentar carga</button>
      </div>

      <div style="margin-top:10px">
        <div class="status">Excel remoto: <span id="excelRemoto" class="muted"></span></div>
        <div class="status">Carpeta PDFs base: <span id="pdfsRemotos" class="muted"></span></div>
        <span class="muted">Leyendo desde GitHub Raw/Media</span>
      </div>
    </section>

    <!-- Buscar -->
    <section class="card">
      <h2 class="title">Buscar por SAP</h2>
      <div class="row">
        <div>
          <label class="muted" for="inputSap">Ingresar SAP</label>
          <input id="inputSap" placeholder="Ej. 5" />
        </div>
        <div>
          <label class="muted" for="selectCategoria">Seleccionar Categoría</label>
          <select id="selectCategoria">
            <option value="">—</option>
          </select>
        </div>
      </div>
      <div style="margin-top:12px">
        <button id="btnBuscar" class="btn" type="button">Buscar PDF</button>
      </div>
    </section>

    <!-- Visor -->
    <section class="card">
      <h2 class="title">Visor</h2>
      <div class="status" id="visorMsg">Sin resultados todavía.</div>
      <div style="display:flex;gap:10px;flex-wrap:wrap">
        <a id="btnAbrirNueva" class="btn" href="#" target="_blank" rel="noopener" style="text-decoration:none;display:none">Abrir en pestaña nueva</a>
        <a id="btnDescargar" class="btn" href="#" download style="text-decoration:none;display:none">Descargar</a>
      </div>

      <!-- Vista previa en la misma card (PDF.js CDN) -->
      <div id="pdfContainer">
        <iframe
          id="pdfFrame"
          title="Vista previa PDF"
          referrerpolicy="no-referrer"
          loading="lazy"
        ></iframe>
      </div>
    </section>
  </main>

  <!-- Admin toggle + Rellenar rutas bajo “Estado” -->
  <script>
    // ====== Admin: ocultar/mostrar tarjeta de estado ======
    const ADMIN_CODE = 'ARA-Admin-2025'; // cámbialo cuando quieras
    const cardEstado = document.getElementById('cardEstado');
    const btnAdmin   = document.getElementById('btnAdmin');

    const isAdmin    = () => localStorage.getItem('ara:isAdmin') === '1';
    const setAdmin   = (v) => localStorage.setItem('ara:isAdmin', v ? '1' : '0');
    const renderAdmin = () => {
      if (isAdmin()) {
        cardEstado.classList.remove('hidden');
        btnAdmin.textContent = 'Admin ✔';
      } else {
        cardEstado.classList.add('hidden');
        btnAdmin.textContent = 'Admin';
      }
    };

    btnAdmin.addEventListener('click', () => {
      if (isAdmin()) {
        if (confirm('Salir del modo administrador?')) {
          setAdmin(false);
          renderAdmin();
        }
        return;
      }
      const code = prompt('Código administrador:');
      if (code && code === ADMIN_CODE) {
        setAdmin(true);
        renderAdmin();
      } else if (code !== null) {
        alert('Código incorrecto');
      }
    });

    // Atajo: Alt + Shift + A para abrir prompt admin
    document.addEventListener('keydown', (e) => {
      if (e.altKey && e.shiftKey && e.key.toLowerCase() === 'a') {
        btnAdmin.click();
      }
    });

    // Render inicial
    renderAdmin();

    // ====== Rellena rutas informativas (aunque la tarjeta esté oculta) ======
    document.addEventListener('DOMContentLoaded', () => {
      const xr = document.getElementById('excelRemoto');
      const pr = document.getElementById('pdfsRemotos');
      if (xr) xr.textContent = window.URL_EXCEL || '';
      if (pr) pr.textContent = window.PDF_BASE  || '';
    });
  </script>

</body>
</html>
